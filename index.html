<DOCTYPE html>
<html>
<head>
<script src="gif.js"></script>
<meta charset="utf-8">
<title>Christmas Hugs - Hug Humanity</title>
<!--
https://github.com/hdragomir/gif.js
-->
<body>

<h1>Christmas Hugs</h1>
<p>Show your love for the world in 3 seconds</p>

<video></video>
<canvas width='640' height='480'></canvas>
<img src="">

<script>


  /*
  Generate GIF
  var gif = new GIF({ workers: 2, quality: 10, width: 640, height: 480 });
  gif.addFrame(ctx, {copy: true});
  gif.render();
  */


  navigator.getUserMedia  = navigator.getUserMedia ||
                          navigator.webkitGetUserMedia ||
                          navigator.mozGetUserMedia ||
                          navigator.msGetUserMedia;

  var constraints = { audio: false, video: true };
  var video = document.querySelector('video');
  var canvas = document.querySelector('canvas');
  var ctx = canvas.getContext('2d');
  var localMediaStream = null;


  video.addEventListener('click', snapshot, false);

  function successCallback(stream) {
    if (window.URL) {
      video.src = window.URL.createObjectURL(stream);
      localMediaStream = stream;
    } else {
      video.src = stream;
    }
    video.play();
  }

  setTimeout(function () {
    snapshot();
  },1000);

  function errorCallback(error) {
    console.log("navigator.getUserMedia error: ", error);
  }

  function makeGif () {
    var gif = new GIF({
      workers: 2,
      quality: 10
    });

    // or copy the pixels from a canvas context
    gif.addFrame(canvas, {delay: 200});
    gif.addFrame(canvas, {delay: 400});

    gif.on('finished', function(blob) {
      console.log(blob);
        window.open(URL.createObjectURL(blob));
    });

    gif.render();

  }

  function snapshot() {
    if (localMediaStream) {
      ctx.drawImage(video, 0, 0);
      // "image/webp" works in Chrome.
      // Other browsers will fall back to image/png.
      document.querySelector('img').src = canvas.toDataURL('image/webp');
    }
  }

  navigator.getUserMedia(constraints, successCallback, errorCallback);

</script>
</body>
</html>

